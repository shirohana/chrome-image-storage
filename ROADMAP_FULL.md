> This file was previous generated by Claude Code, but too complex so I asked to 
> simplify to ROADMAP.md. This file is just a more detailed version of that.

# Image Storage Extension - Enhancement Roadmap

## Current State Analysis

**Implemented Features:**
- ✅ Grid view (280px cards, cropped preview)
- ✅ Text search (URL/title)
- ✅ Individual delete
- ✅ Export all to ZIP
- ✅ Hardcoded sort (newest first)
- ✅ Auto-refresh viewer when images saved
- ✅ Focus existing viewer tab

**Current Limitations:**
- No bulk operations
- Single view mode only
- No sorting options
- Limited filtering
- No image preview (shows cropped)
- No grouping capabilities

---

## Proposed Enhancement Phases

### **Phase 1: Selection & Bulk Operations**
**Priority**: High | **Complexity**: Medium | **Estimated Time**: 3-4 hours

**Goal**: Manage multiple images efficiently

**Features**:
1. Multi-select with checkboxes on image cards
2. "Select All" / "Select None" buttons
3. Bulk delete selected images (with confirmation)
4. "Delete All" button (with strong confirmation)
5. Export selected images (in addition to export all)
6. Show selection count in header

**Technical Implementation**:
- Add selection state to component
- Add checkbox to each image card
- Implement selection logic (Set of IDs)
- Add bulk action buttons to header
- Create confirmation dialogs

**Files to Modify**:
- `src/viewer/index.html` - Add selection UI
- `src/viewer/index.ts` - Add selection logic
- `src/viewer/style.css` - Style checkboxes and selection states
- `src/storage/service.ts` - Add `deleteMultiple()` function
- `src/storage/db.ts` - Add batch delete operation

---

### **Phase 2: View Modes & Layout**
**Priority**: High | **Complexity**: Low | **Estimated Time**: 1-2 hours

**Goal**: See more images at once

**Features**:
1. View mode toggle (Grid / Compact / List)
   - **Grid**: Current (280px cards, large preview)
   - **Compact**: Smaller cards (150px, 4-6 per row)
   - **List**: Horizontal rows (thumbnail + metadata)
2. Save view preference to localStorage
3. Responsive grid columns

**Technical Implementation**:
- Add view mode toggle buttons in header
- Create CSS classes for each view mode
- Store preference in localStorage
- Apply view mode class to container

**Files to Modify**:
- `src/viewer/index.html` - Add view mode toggle buttons
- `src/viewer/index.ts` - Add view mode switching logic
- `src/viewer/style.css` - Add compact/list view styles

**CSS Strategy**:
```css
.image-grid.compact { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
.image-grid.compact .image-preview { height: 100px; }
.image-grid.list { display: flex; flex-direction: column; }
```

---

### **Phase 3: Sorting**
**Priority**: Medium | **Complexity**: Low | **Estimated Time**: 1-2 hours

**Goal**: Organize images by different criteria

**Features**:
1. Sort dropdown with options:
   - Date saved (newest/oldest)
   - File size (largest/smallest)
   - Dimensions (largest/smallest)
   - File name/URL (A-Z/Z-A)
2. Sort direction toggle button (↑↓)
3. Remember sort preference in localStorage

**Technical Implementation**:
- Add sort dropdown and direction button
- Implement sort functions for each criteria
- Update `loadImages()` to apply sorting
- Store preference in localStorage

**Files to Modify**:
- `src/viewer/index.html` - Add sort controls
- `src/viewer/index.ts` - Add sorting logic
- `src/viewer/style.css` - Style sort controls

**Sort Functions**:
```typescript
const sortFunctions = {
  savedAt: (a, b) => b.savedAt - a.savedAt,
  fileSize: (a, b) => b.fileSize - a.fileSize,
  dimensions: (a, b) => (b.width * b.height) - (a.width * a.height),
  url: (a, b) => a.imageUrl.localeCompare(b.imageUrl)
};
```

---

### **Phase 4: Advanced Filtering**
**Priority**: Medium | **Complexity**: Medium | **Estimated Time**: 3-4 hours

**Goal**: Find specific images quickly

**Features**:
1. Filter panel (collapsible)
2. Filter by MIME type (checkboxes: PNG, JPEG, WebP, GIF, etc.)
3. Filter by date range (date pickers: from/to)
4. Filter by file size range (sliders: 0-10MB)
5. Filter by source domain (dropdown or autocomplete)
6. Combine with existing text search
7. Show active filter count badge

**Technical Implementation**:
- Create collapsible filter panel
- Add filter controls for each type
- Implement filter combination logic
- Extract unique domains/types from images
- Update `renderImages()` to apply filters

**Files to Modify**:
- `src/viewer/index.html` - Add filter panel
- `src/viewer/index.ts` - Add filtering logic
- `src/viewer/style.css` - Style filter panel

**Filter State**:
```typescript
interface FilterState {
  mimeTypes: Set<string>;
  dateFrom?: Date;
  dateTo?: Date;
  sizeMin?: number;
  sizeMax?: number;
  domains: Set<string>;
}
```

---

### **Phase 5: Grouping**
**Priority**: Low-Medium | **Complexity**: Medium-High | **Estimated Time**: 4-5 hours

**Goal**: Organize images into categories

**Features**:
1. Group by selector (None / Domain / Type / Date)
2. Collapsible group headers with counts
3. Group operations (delete all in group, export group)
4. Visual separators between groups
5. Sort within groups

**Technical Implementation**:
- Add group by dropdown
- Implement grouping logic
- Create group header components
- Add per-group actions
- Update rendering to show groups

**Files to Modify**:
- `src/viewer/index.html` - Add group controls
- `src/viewer/index.ts` - Add grouping logic
- `src/viewer/style.css` - Style group headers

**Grouping Functions**:
```typescript
function groupBy(images: SavedImage[], key: 'domain' | 'mimeType' | 'date') {
  // Group images and return Map<string, SavedImage[]>
}
```

---

### **Phase 6: Image Preview & Details**
**Priority**: High | **Complexity**: Medium | **Estimated Time**: 2-3 hours

**Goal**: View full images without cropping

**Features**:
1. Click image to open lightbox modal
2. Show full-size image (not cropped, actual dimensions)
3. Zoom in/out controls
4. Navigate between images (← → arrow keys)
5. Display full metadata panel
6. Close with ESC key or click outside
7. Download original button

**Technical Implementation**:
- Create lightbox modal component
- Add click handler to images
- Implement keyboard navigation
- Add zoom controls
- Show full metadata

**Files to Modify**:
- `src/viewer/index.html` - Add lightbox modal
- `src/viewer/index.ts` - Add lightbox logic
- `src/viewer/style.css` - Style lightbox/modal

**Modal Features**:
- Full-screen overlay
- Image centered with max-width/max-height
- Previous/Next navigation
- Close button + ESC key
- Metadata sidebar

---

### **Phase 7: Additional Enhancements**
**Priority**: Future | **Complexity**: Varies | **Estimated Time**: TBD

**Nice-to-have features**:

1. **Tags Management**
   - Add/edit custom tags to images
   - Filter by tags
   - Tag autocomplete

2. **Duplicate Detection**
   - Find similar images by dimension/size
   - Hash-based duplicate detection
   - Merge/delete duplicates

3. **Import from ZIP**
   - Load previously exported images
   - Restore from backup

4. **Statistics Dashboard**
   - Total storage size
   - Images per domain chart
   - File type breakdown
   - Timeline visualization

5. **Performance Optimizations**
   - Virtual scrolling for 1000+ images
   - Lazy loading images
   - IndexedDB pagination

6. **Image Editing**
   - Basic crop/rotate
   - Save edited versions
   - Revert to original

---

## Recommended Implementation Order

### **Iteration 1: Quick Wins** (2-3 hours)
Focus on immediate usability improvements:
1. ✅ Phase 2: View Modes (compact view)
2. ✅ Phase 3: Sorting

**Why**: Low complexity, high value, immediate UX improvement

---

### **Iteration 2: Power Features** (5-7 hours)
Add most requested features:
1. ✅ Phase 1: Selection & Bulk Operations
2. ✅ Phase 6: Image Preview Lightbox

**Why**: High value for power users, essential functionality

---

### **Iteration 3: Advanced** (7-9 hours)
Polish and advanced features:
1. ✅ Phase 4: Advanced Filtering
2. ✅ Phase 5: Grouping

**Why**: Nice-to-have for organization, lower priority

---

### **Future Iterations**
Based on user feedback:
- Phase 7 features as needed
- Performance optimizations if needed
- Additional UX improvements

---

## Technical Considerations

### Performance
- Consider virtual scrolling if users save 500+ images
- Lazy load blob URLs (don't create all at once)
- Debounce search/filter inputs
- Use CSS transforms for animations

### Data Migration
- No schema changes needed for Phases 1-6
- All features use existing `SavedImage` structure
- localStorage for UI preferences only

### Code Organization
- Keep viewer code modular
- Extract components where helpful
- Maintain "make it work first" philosophy
- Add features incrementally

### Browser Compatibility
- All features work in modern Chrome
- Use standard Web APIs
- No external dependencies needed (except JSZip for export)

### Testing Strategy
- Manual testing with various image counts
- Test with different image types/sizes
- Verify localStorage persistence
- Test keyboard shortcuts
- Verify bulk operations work correctly

---

## Success Metrics

**Phase 1**: Users can delete 10 images in < 5 seconds
**Phase 2**: Users can see 2x more images in compact view
**Phase 3**: Users can find oldest/largest images instantly
**Phase 4**: Users can filter 100+ images to specific subset
**Phase 5**: Users can organize images by domain/type/date
**Phase 6**: Users can view full-size images without cropping

---

## Notes

- Maintain backward compatibility with existing storage
- Keep bundle size small (no heavy frameworks)
- Follow existing code style and patterns
- Document new features in README
- Test with real-world usage patterns
